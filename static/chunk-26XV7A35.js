import{a as ne,b as oe,c as ae,d as re,e as Se,k as Ne,l as ke,m as Be,n as Ve,o as qe,p as F}from"./chunk-6KM6G2XG.js";import{Aa as Ee,Ca as Oe,Ea as B,Ga as ve,Ha as Me,Ia as we,Ka as V,La as ye,Ma as Ge,Oa as Ie,Pa as Ae,Q as Y,Ra as Re,Xa as Fe,_a as $e,ab as Pe,cb as Ue,ea as me,fb as He,ga as le,gb as je,ha as pe,hb as Le,ia as de,ib as ze,ja as se,jb as We,ka as ce,kb as Qe,lb as Ze,ma as ue,mb as Je,na as _e,ob as Ke,pa as fe,qa as Ce,qb as R,sa as be,ta as xe,va as he,wa as Te,xa as ge,za as De}from"./chunk-I3PSDZLR.js";import{$b as P,Bb as x,Cb as v,Db as M,Eb as w,Fb as o,Gb as n,Hb as c,Ib as f,Jb as C,Kb as z,Lb as y,Nc as J,O as U,Ob as T,Oc as K,Qb as u,Qc as X,Rc as A,Yb as W,Zb as m,Zc as ee,_b as G,_c as te,ab as p,ad as N,bb as _,bd as k,cc as g,dc as Q,dd as ie,ec as I,gc as S,hc as D,ic as Z,na as h,pb as H,t as q,ub as d,va as E,vb as j,wa as O,wb as s,yb as L}from"./chunk-4N56W5ZJ.js";var $=class e{constructor(t){this.orders=[],Object.assign(this,t)}static createFromApiModel(t){return new e({id:t.id,createdAt:t.created_at,hostMember:t.host_member,status:t.status,actualAmount:t.actual_amount,orders:t.orders.map(i=>Se.createFromApiModel(i))})}get total(){return this.orders.reduce((t,i)=>t+i.subtotal,0)}get totalCount(){return this.orders.reduce((t,i)=>t+i.totalCount,0)}};var Xe={IN_PROGRESS:"in_progress",COMPLETED:"completed",CANCELLED:"cancelled"};function ot(e,t){if(e&1&&(o(0,"mat-option",4),m(1),n()),e&2){let i=t.$implicit;s("value",i.id),p(),G(i.orderedBy)}}var et=(()=>{let t=class t{constructor(a,r,l){this.data=a,this._groupOrderService=r,this._dialogRef=l,this.isSubmitting=!1,this._constructForm()}_constructForm(){this.mainForm=new we({orders:new V(this.data.orders.map(a=>a.id)),actualAmount:new V(this.data.total,[B.required,B.min(0)])})}completeOrder(){let a={orders:this.mainForm.value.orders,actual_amount:this.mainForm.value.actualAmount};this.isSubmitting=!0,this._groupOrderService.complete(this.data.id,a).pipe(U(()=>this.isSubmitting=!1)).subscribe(()=>{this._dialogRef.close(this.data.id)})}};t.\u0275fac=function(r){return new(r||t)(_(Le),_(F),_(je))},t.\u0275cmp=h({type:t,selectors:[["app-complete-group-order-dialog"]],standalone:!0,features:[g],decls:19,vars:3,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"w-100"],["formControlName","orders","multiple",""],[3,"value"],["matInput","","formControlName","actualAmount","type","number"],["align","end"],["mat-raised-button","","mat-dialog-close","",1,"mr-2"],[3,"action","disabled","isSubmitting"]],template:function(r,l){r&1&&(o(0,"h2",0),m(1,"Complete order"),n(),o(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),m(6,"Orders"),n(),o(7,"mat-select",3),M(8,ot,2,2,"mat-option",4,v),n()(),o(10,"mat-form-field",2)(11,"mat-label"),m(12,"Actual amount"),n(),c(13,"input",5),n()()(),o(14,"mat-dialog-actions",6)(15,"button",7),m(16,"Close"),n(),o(17,"app-submit-button",8),T("action",function(){return l.completeOrder()}),m(18,"Complete "),n()()),r&2&&(p(3),s("formGroup",l.mainForm),p(5),w(l.data.orders),p(9),s("disabled",!l.mainForm.valid)("isSubmitting",l.isSubmitting))},dependencies:[Qe,Ze,Je,me,$e,Fe,Pe,Re,ye,Oe,Ge,ve,Me,Ie,Ae,Ke,We,Ne,Y]});let e=t;return e})();var mt=()=>["expandedDetail"],lt=e=>({$implicit:e});function pt(e,t){e&1&&(o(0,"th",17),m(1," Time "),n())}function dt(e,t){if(e&1&&(o(0,"td",18),m(1),S(2,"date"),n()),e&2){let i=t.$implicit;p(),P(" ",D(2,1,i.createdAt)," ")}}function st(e,t){e&1&&(o(0,"th",17),m(1," Host "),n())}function ct(e,t){if(e&1&&(o(0,"td",18),c(1,"app-member-display",19),n()),e&2){let i=t.$implicit;p(),s("member",i.hostMember)}}function ut(e,t){e&1&&(o(0,"th",17),m(1," Actual amount "),n())}function _t(e,t){if(e&1&&(o(0,"td",18),m(1),n()),e&2){let i=t.$implicit;p(),P(" ",i.actualAmount," ")}}function ft(e,t){e&1&&(o(0,"th",17),m(1," Status "),n())}function Ct(e,t){if(e&1&&(o(0,"td",18),c(1,"app-status-badge",20),n()),e&2){let i=t.$implicit;p(),s("status",i.status)}}function bt(e,t){e&1&&(o(0,"th",17),m(1," Actions "),n())}function xt(e,t){if(e&1){let i=y();o(0,"button",22),T("click",function(r){E(i);let l=u().$implicit,b=u();return r.stopPropagation(),O(b.complete(l))}),o(1,"mat-icon"),m(2,"task_alt"),n()()}}function ht(e,t){if(e&1&&(o(0,"td",18),d(1,xt,3,0,"button",21),n()),e&2){let i=t.$implicit,a=u();p(),x(a.currentUserId===i.hostMember.id&&i.status===a.OrderStatusEnum.IN_PROGRESS?1:-1)}}function Tt(e,t){e&1&&(o(0,"th",23),m(1,"\xA0"),n())}function gt(e,t){e&1&&(o(0,"mat-icon"),m(1,"keyboard_arrow_up"),n())}function St(e,t){e&1&&(o(0,"mat-icon"),m(1,"keyboard_arrow_down"),n())}function Dt(e,t){if(e&1){let i=y();o(0,"td",18)(1,"button",24),T("click",function(r){let l=E(i).$implicit,b=u();return b.expandedElement=b.expandedElement===l?null:l,O(r.stopPropagation())}),d(2,gt,2,0,"mat-icon")(3,St,2,0,"mat-icon"),n()()}if(e&2){let i=t.$implicit,a=u();p(2),x(a.expandedElement===i?2:3)}}function Et(e,t){e&1&&z(0)}function Ot(e,t){if(e&1&&(o(0,"td",18)(1,"div",25),d(2,Et,1,0,"ng-container",26),n()()),e&2){let i=t.$implicit,a=u(),r=W(27);j("colspan",a.columnsToDisplayWithExpand.length),p(),s("@detailExpand",i==a.expandedElement?"expanded":"collapsed"),p(),s("ngTemplateOutlet",r)("ngTemplateOutletContext",I(4,lt,i.orders))}}function vt(e,t){e&1&&c(0,"tr",27)}function Mt(e,t){if(e&1){let i=y();o(0,"tr",28),T("click",function(){let r=E(i).$implicit,l=u();return O(l.expandedElement=l.expandedElement===r?null:r)}),n()}if(e&2){let i=t.$implicit,a=u();L("expanded-row",a.expandedElement===i)}}function wt(e,t){e&1&&c(0,"tr",29)}function yt(e,t){e&1&&(o(0,"tr",30)(1,"td",31),m(2,"No data."),n()())}function Gt(e,t){if(e&1&&(o(0,"tr")(1,"td",33),c(2,"app-member-display",19),n(),o(3,"td",33),m(4),n(),o(5,"td",33),c(6,"app-status-badge",20),n()()),e&2){let i=t.$implicit;p(2),s("member",i.orderedBy),p(2),G(i.subtotal),p(2),s("status",i.status)}}function It(e,t){if(e&1&&(o(0,"table")(1,"tr")(2,"th",32),m(3,"Member"),n(),o(4,"th",32),m(5,"Total"),n(),o(6,"th",32),m(7,"Status"),n()(),M(8,Gt,7,3,"tr",null,v),n()),e&2){let i=u().$implicit;p(8),w(i)}}function At(e,t){if(e&1&&(o(0,"div"),d(1,It,10,0,"table"),n()),e&2){let i=t.$implicit;p(),x(i.length>0?1:-1)}}var tt=(()=>{let t=class t extends Ve{constructor(a,r,l){super(),this._groupOrderService=a,this._appData=r,this._dialog=l,this.OrderStatusEnum=Xe,this.columnsToDisplay=["time","host","amount","status","actions"],this.columnsToDisplayWithExpand=[...this.columnsToDisplay,"expand"],this._appData.currentUser$.subscribe(b=>this.currentUserId=b.id),this._queryRequest=this._constructQueryRequest.bind(this)}_constructQueryRequest(){return this._groupOrderService.query(this.queryParams??{}).pipe(q(a=>a.map(r=>$.createFromApiModel(r))))}complete(a){this._dialog.open(et,{data:a}).afterClosed().subscribe(()=>this.refresh())}};t.\u0275fac=function(r){return new(r||t)(_(F),_(R),_(ze))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-table"]],inputs:{queryParams:"queryParams"},standalone:!0,features:[H,g],decls:28,vars:7,consts:[["orderDetails",""],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","host"],["matColumnDef","amount"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expand"],["mat-header-cell","","aria-label","row actions",4,"matHeaderCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","expanding-row",3,"expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page",3,"pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[3,"member"],[3,"status"],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete"],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete",3,"click"],["mat-header-cell","","aria-label","row actions"],["mat-icon-button","","aria-label","expand row",3,"click"],[1,"d-flex","overflow-hidden"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-header-row",""],["mat-row","",1,"expanding-row",3,"click"],["mat-row","",1,"detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"],[1,"px-4"],[1,"p-1"]],template:function(r,l){r&1&&(o(0,"table",1),f(1,2),d(2,pt,2,0,"th",3)(3,dt,3,3,"td",4),C(),f(4,5),d(5,st,2,0,"th",3)(6,ct,2,1,"td",4),C(),f(7,6),d(8,ut,2,0,"th",3)(9,_t,2,1,"td",4),C(),f(10,7),d(11,ft,2,0,"th",3)(12,Ct,2,1,"td",4),C(),f(13,8),d(14,bt,2,0,"th",3)(15,ht,2,1,"td",4),C(),f(16,9),d(17,Tt,2,0,"th",10)(18,Dt,4,1,"td",4),C(),f(19,11),d(20,Ot,3,6,"td",4),C(),d(21,vt,1,0,"tr",12)(22,Mt,1,2,"tr",13)(23,wt,1,0,"tr",14)(24,yt,3,0,"tr",15),n(),c(25,"mat-paginator",16),d(26,At,2,1,"ng-template",null,0,Z)),r&2&&(s("dataSource",l.dataSource),p(21),s("matHeaderRowDef",l.columnsToDisplayWithExpand),p(),s("matRowDefColumns",l.columnsToDisplayWithExpand),p(),s("matRowDefColumns",Q(6,mt)),p(2),s("pageSize",l.DEFAULT_PAGINATOR_PAGE_SIZE)("pageSizeOptions",l.PAGINATOR_SIZE_OPTIONS))},dependencies:[ge,de,ce,Ce,ue,se,be,_e,fe,xe,he,Te,pe,le,Ee,De,He,X,Be,ke,A,J,qe,Ue],data:{animation:[ee("detailExpand",[k("collapsed,void",N({height:"0px",minHeight:"0"})),k("expanded",N({height:"*"})),ie("expanded <=> collapsed",te("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}});let e=t;return e})();var Rt=e=>({host_member:e});function Ft(e,t){e&1&&c(0,"app-group-orders-table")}function $t(e,t){e&1&&(o(0,"div",3),m(1,"Login to view content."),n())}function Pt(e,t){if(e&1&&(c(0,"app-group-orders-table",6),S(1,"async")),e&2){let i,a=u(2);s("queryParams",I(3,Rt,(i=D(1,1,a.currentUser$))==null?null:i.id))}}function Nt(e,t){e&1&&(o(0,"div",3),m(1,"Login to view content."),n())}function kt(e,t){if(e&1&&(d(0,Pt,2,5,"app-group-orders-table",6),S(1,"async"),d(2,Nt,2,0,"div",3)),e&2){let i=u();x(D(1,1,i.currentUser$)?0:2)}}var gi=(()=>{let t=class t{constructor(a){this._appData=a,this.currentUser$=this._appData.currentUser$}};t.\u0275fac=function(r){return new(r||t)(_(R))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-dashboard"]],standalone:!0,features:[g],decls:9,vars:3,consts:[[1,"text-align-center"],["mat-stretch-tabs","false","mat-align-tabs","start"],["label","All"],[1,"m-4"],["label","Mine"],["matTabContent",""],[3,"queryParams"]],template:function(r,l){r&1&&(o(0,"h1",0),m(1,"Group orders"),n(),o(2,"mat-tab-group",1)(3,"mat-tab",2),d(4,Ft,1,0,"app-group-orders-table"),S(5,"async"),d(6,$t,2,0,"div",3),n(),o(7,"mat-tab",4),d(8,kt,3,3,"ng-template",5),n()()),r&2&&(p(4),x(D(5,1,l.currentUser$)?4:6))},dependencies:[re,ne,oe,ae,A,K,tt]});let e=t;return e})();export{gi as GroupOrdersDashboardComponent};
