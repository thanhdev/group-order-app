import{I as Ne,J as Be,K as Ve,L as qe,M as He,N as je,O as Ue,P as ze,Q as Le,R as We,S as Qe,T as Ze,V as Je,W as $,f as oe,g as ae,h as re,i as le,j as se,k as ce,l as ue,n as _e,o as fe,q as Ce,r as be,t as xe,u as he,w as Te,x as ge,y as Se,z as De}from"./chunk-BCPUK5UR.js";import{Aa as Pe,Ca as ke,Ha as R,Y as ee,ca as me,da as pe,ea as de,fa as ve,ga as Ee,ia as Oe,ka as B,ma as Me,na as we,oa as ye,qa as V,ra as Ge,sa as Ie,ta as Ae,ua as Fe,wa as Re,xa as $e}from"./chunk-66BJH6TV.js";import{$b as E,Bb as x,Cb as w,Db as y,Eb as G,Fb as o,Gb as n,Hb as _,Ib as f,Jb as C,Kb as W,Lb as I,Nc as K,O as j,Ob as T,Oc as X,Qb as c,Qc as Y,Rc as F,Yb as Q,Zb as l,Zc as te,_b as v,_c as ie,ab as p,ad as k,bb as u,bd as N,cc as g,dc as Z,dd as ne,ec as A,gc as S,hc as D,ic as J,na as h,pb as U,t as H,ub as d,va as O,vb as z,wa as M,wb as s,yb as L}from"./chunk-4N56W5ZJ.js";var P=class e{constructor(t){this.orders=[],Object.assign(this,t)}static createFromApiModel(t){return new e({id:t.id,createdAt:t.created_at,hostMember:t.host_member,status:t.status,actualAmount:t.actual_amount,orders:t.orders.map(i=>De.createFromApiModel(i))})}get total(){return this.orders.reduce((t,i)=>t+i.subtotal,0)}get totalCount(){return this.orders.reduce((t,i)=>t+i.totalCount,0)}};var q=function(e){return e.InProgress="in_progress",e.Completed="completed",e.Cancelled="cancelled",e}(q||{});function it(e,t){if(e&1&&(o(0,"mat-option",4),l(1),n()),e&2){let i=t.$implicit;s("value",i.id),p(),v(i.orderedBy)}}var Xe=(()=>{let t=class t{constructor(a,r,m){this.data=a,this._groupOrderService=r,this._dialogRef=m,this.isSubmitting=!1,this._constructForm()}_constructForm(){this.mainForm=new ye({orders:new V(this.data.orders.map(a=>a.id)),actualAmount:new V(this.data.total,[B.required,B.min(0)])})}completeOrder(){let a={orders:this.mainForm.value.orders,actual_amount:this.mainForm.value.actualAmount};this.isSubmitting=!0,this._groupOrderService.complete(this.data.id,a).pipe(j(()=>this.isSubmitting=!1)).subscribe(()=>{this._dialogRef.close(this.data.id)})}};t.\u0275fac=function(r){return new(r||t)(u(Ue),u($),u(je))},t.\u0275cmp=h({type:t,selectors:[["app-complete-group-order-dialog"]],standalone:!0,features:[g],decls:19,vars:3,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"w-100"],["formControlName","orders","multiple",""],[3,"value"],["matInput","","formControlName","actualAmount","type","number"],["align","end"],["mat-raised-button","","mat-dialog-close","",1,"mr-2"],[3,"action","disabled","isSubmitting"]],template:function(r,m){r&1&&(o(0,"h2",0),l(1,"Complete order"),n(),o(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),l(6,"Orders"),n(),o(7,"mat-select",3),y(8,it,2,2,"mat-option",4,w),n()(),o(10,"mat-form-field",2)(11,"mat-label"),l(12,"Actual amount"),n(),_(13,"input",5),n()()(),o(14,"mat-dialog-actions",6)(15,"button",7),l(16,"Close"),n(),o(17,"app-submit-button",8),T("action",function(){return m.completeOrder()}),l(18,"Complete "),n()()),r&2&&(p(3),s("formGroup",m.mainForm),p(5),G(m.data.orders),p(9),s("disabled",!m.mainForm.valid)("isSubmitting",m.isSubmitting))},dependencies:[We,Qe,Ze,me,Pe,$e,ke,Re,Ge,Oe,Ie,Me,we,Ae,Fe,Je,Le,Ne,ee]});let e=t;return e})();var at=()=>["expandedDetail"],rt=e=>({$implicit:e});function lt(e,t){e&1&&(o(0,"th",17),l(1," Time "),n())}function mt(e,t){if(e&1&&(o(0,"td",18),l(1),S(2,"date"),n()),e&2){let i=t.$implicit;p(),E(" ",D(2,1,i.createdAt)," ")}}function pt(e,t){e&1&&(o(0,"th",17),l(1," Host "),n())}function dt(e,t){if(e&1&&(o(0,"td",18),l(1),n()),e&2){let i=t.$implicit;p(),E(" ",i.hostMember.name," ")}}function st(e,t){e&1&&(o(0,"th",17),l(1," Actual amount "),n())}function ct(e,t){if(e&1&&(o(0,"td",18),l(1),n()),e&2){let i=t.$implicit;p(),E(" ",i.actualAmount," ")}}function ut(e,t){e&1&&(o(0,"th",17),l(1," Status "),n())}function _t(e,t){if(e&1&&(o(0,"td",18),l(1),n()),e&2){let i=t.$implicit;p(),E(" ",i.status," ")}}function ft(e,t){e&1&&(o(0,"th",17),l(1," Actions "),n())}function Ct(e,t){if(e&1){let i=I();o(0,"button",20),T("click",function(r){O(i);let m=c().$implicit,b=c();return r.stopPropagation(),M(b.complete(m))}),o(1,"mat-icon"),l(2,"task_alt"),n()()}}function bt(e,t){if(e&1&&(o(0,"td",18),d(1,Ct,3,0,"button",19),n()),e&2){let i=t.$implicit,a=c();p(),x(a.currentUserId===i.hostMember.id&&i.status===a.OrderStatusEnum.InProgress?1:-1)}}function xt(e,t){e&1&&(o(0,"th",21),l(1,"\xA0"),n())}function ht(e,t){e&1&&(o(0,"mat-icon"),l(1,"keyboard_arrow_up"),n())}function Tt(e,t){e&1&&(o(0,"mat-icon"),l(1,"keyboard_arrow_down"),n())}function gt(e,t){if(e&1){let i=I();o(0,"td",18)(1,"button",22),T("click",function(r){let m=O(i).$implicit,b=c();return b.expandedElement=b.expandedElement===m?null:m,M(r.stopPropagation())}),d(2,ht,2,0,"mat-icon")(3,Tt,2,0,"mat-icon"),n()()}if(e&2){let i=t.$implicit,a=c();p(2),x(a.expandedElement===i?2:3)}}function St(e,t){e&1&&W(0)}function Dt(e,t){if(e&1&&(o(0,"td",18)(1,"div",23),d(2,St,1,0,"ng-container",24),n()()),e&2){let i=t.$implicit,a=c(),r=Q(27);z("colspan",a.columnsToDisplayWithExpand.length),p(),s("@detailExpand",i==a.expandedElement?"expanded":"collapsed"),p(),s("ngTemplateOutlet",r)("ngTemplateOutletContext",A(4,rt,i.orders))}}function vt(e,t){e&1&&_(0,"tr",25)}function Et(e,t){if(e&1){let i=I();o(0,"tr",26),T("click",function(){let r=O(i).$implicit,m=c();return M(m.expandedElement=m.expandedElement===r?null:r)}),n()}if(e&2){let i=t.$implicit,a=c();L("expanded-row",a.expandedElement===i)}}function Ot(e,t){e&1&&_(0,"tr",27)}function Mt(e,t){e&1&&(o(0,"tr",28)(1,"td",29),l(2,"No data."),n()())}function wt(e,t){if(e&1&&(o(0,"tr")(1,"td"),l(2),n(),o(3,"td"),l(4),n()()),e&2){let i=t.$implicit;p(2),v(i.orderedBy),p(2),v(i.subtotal)}}function yt(e,t){if(e&1&&(o(0,"table")(1,"tr")(2,"th"),l(3,"Member"),n(),o(4,"th"),l(5,"Total"),n()(),y(6,wt,5,2,"tr",null,w),n()),e&2){let i=c().$implicit;p(6),G(i)}}function Gt(e,t){if(e&1&&(o(0,"div"),d(1,yt,8,0,"table"),n()),e&2){let i=t.$implicit;p(),x(i.length>0?1:-1)}}var Ye=(()=>{let t=class t extends qe{constructor(a,r,m){super(),this._groupOrderService=a,this._appData=r,this._dialog=m,this.OrderStatusEnum=q,this.columnsToDisplay=["time","host","amount","status","actions"],this.columnsToDisplayWithExpand=[...this.columnsToDisplay,"expand"],this._appData.currentUser$.subscribe(b=>this.currentUserId=b.id),this._queryRequest=this._constructQueryRequest.bind(this)}_constructQueryRequest(){return this._groupOrderService.query(this.queryParams??{}).pipe(H(a=>a.map(r=>P.createFromApiModel(r))))}complete(a){this._dialog.open(Xe,{data:a}).afterClosed().subscribe(()=>this.refresh())}};t.\u0275fac=function(r){return new(r||t)(u($),u(R),u(ze))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-table"]],inputs:{queryParams:"queryParams"},standalone:!0,features:[U,g],decls:28,vars:7,consts:[["orderDetails",""],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","host"],["matColumnDef","amount"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expand"],["mat-header-cell","","aria-label","row actions",4,"matHeaderCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","expanding-row",3,"expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page",3,"pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete"],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete",3,"click"],["mat-header-cell","","aria-label","row actions"],["mat-icon-button","","aria-label","expand row",3,"click"],[1,"expanding-row-detail"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-header-row",""],["mat-row","",1,"expanding-row",3,"click"],["mat-row","",1,"detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(r,m){r&1&&(o(0,"table",1),f(1,2),d(2,lt,2,0,"th",3)(3,mt,3,3,"td",4),C(),f(4,5),d(5,pt,2,0,"th",3)(6,dt,2,1,"td",4),C(),f(7,6),d(8,st,2,0,"th",3)(9,ct,2,1,"td",4),C(),f(10,7),d(11,ut,2,0,"th",3)(12,_t,2,1,"td",4),C(),f(13,8),d(14,ft,2,0,"th",3)(15,bt,2,1,"td",4),C(),f(16,9),d(17,xt,2,0,"th",10)(18,gt,4,1,"td",4),C(),f(19,11),d(20,Dt,3,6,"td",4),C(),d(21,vt,1,0,"tr",12)(22,Et,1,2,"tr",13)(23,Ot,1,0,"tr",14)(24,Mt,3,0,"tr",15),n(),_(25,"mat-paginator",16),d(26,Gt,2,1,"ng-template",null,0,J)),r&2&&(s("dataSource",m.dataSource),p(21),s("matHeaderRowDef",m.columnsToDisplayWithExpand),p(),s("matRowDefColumns",m.columnsToDisplayWithExpand),p(),s("matRowDefColumns",Z(6,at)),p(2),s("pageSize",m.DEFAULT_PAGINATOR_PAGE_SIZE)("pageSizeOptions",m.PAGINATOR_SIZE_OPTIONS))},dependencies:[Se,se,ue,be,_e,ce,xe,fe,Ce,he,Te,ge,de,pe,Ee,ve,He,Y,Ve,Be,F,K],data:{animation:[te("detailExpand",[N("collapsed,void",k({height:"0px",minHeight:"0"})),N("expanded",k({height:"*"})),ne("expanded <=> collapsed",ie("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}});let e=t;return e})();var It=e=>({host_member:e});function At(e,t){e&1&&_(0,"app-group-orders-table")}function Ft(e,t){e&1&&(o(0,"div",3),l(1,"Login to view content."),n())}function Rt(e,t){if(e&1&&(_(0,"app-group-orders-table",6),S(1,"async")),e&2){let i,a=c(2);s("queryParams",A(3,It,(i=D(1,1,a.currentUser$))==null?null:i.id))}}function $t(e,t){e&1&&(o(0,"div",3),l(1,"Login to view content."),n())}function Pt(e,t){if(e&1&&(d(0,Rt,2,5,"app-group-orders-table",6),S(1,"async"),d(2,$t,2,0,"div",3)),e&2){let i=c();x(D(1,1,i.currentUser$)?0:2)}}var bi=(()=>{let t=class t{constructor(a){this._appData=a,this.currentUser$=this._appData.currentUser$}};t.\u0275fac=function(r){return new(r||t)(u(R))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-dashboard"]],standalone:!0,features:[g],decls:9,vars:3,consts:[[1,"text-align-center"],["mat-stretch-tabs","false","mat-align-tabs","start"],["label","All"],[1,"m-4"],["label","Mine"],["matTabContent",""],[3,"queryParams"]],template:function(r,m){r&1&&(o(0,"h1",0),l(1,"Group orders"),n(),o(2,"mat-tab-group",1)(3,"mat-tab",2),d(4,At,1,0,"app-group-orders-table"),S(5,"async"),d(6,Ft,2,0,"div",3),n(),o(7,"mat-tab",4),d(8,Pt,3,3,"ng-template",5),n()()),r&2&&(p(4),x(D(5,1,m.currentUser$)?4:6))},dependencies:[le,oe,ae,re,F,X,Ye]});let e=t;return e})();export{bi as GroupOrdersDashboardComponent};
