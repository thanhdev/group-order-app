import{a as Rt,b as Pt}from"./chunk-GP63N4TC.js";import{$a as xt,Aa as ut,Ca as I,Ea as g,Ga as E,Ha as ft,Ia as _t,Ka as S,La as Ct,Ma as bt,Na as ht,Oa as Mt,Pa as vt,Ra as F,Xa as w,_a as R,ab as P,bb as A,cb as N,ea as y,eb as gt,gb as St,h as X,ha as tt,hb as Dt,ia as et,ib as Tt,ja as it,jb as yt,ka as nt,kb as It,lb as Et,m as Z,ma as ot,mb as Ft,na as at,nb as j,ob as wt,pa as rt,pb as At,qa as mt,qb as Nt,sa as lt,ta as st,va as ct,xa as dt,za as pt}from"./chunk-I3PSDZLR.js";import{$b as C,Bb as _,Fb as o,Gb as n,Hb as p,Ib as h,Jb as M,Lb as U,O as D,Ob as x,Qb as f,Qc as W,Za as Y,Zb as m,_b as J,ab as l,bb as u,cc as v,da as O,gc as K,hc as Q,ia as z,na as b,ob as T,t as G,ua as $,ub as d,va as k,wa as q,wb as c}from"./chunk-4N56W5ZJ.js";var V=class t{constructor(e){Object.assign(this,e)}static createFromApiModel(e){return new t({id:e.id,amount:e.amount,createdAt:new Date(e.created_at),fromMember:e.from_member,toMember:e.to_member,transactionType:e.type})}};var H=(()=>{let e=class e{constructor(i){this._requestHelper=i}query(i){return this._requestHelper.get("/transactions",{params:i})}trade(i,r){return this._requestHelper.post("/transactions",{to_member:i,amount:r})}};e.\u0275fac=function(r){return new(r||e)(z(gt))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function kt(t,e){t&1&&(o(0,"th",11),m(1," No. "),n())}function qt(t,e){if(t&1&&(o(0,"td",12),m(1),n()),t&2){let a=e.index;l(),C(" ",a+1," ")}}function Ut(t,e){t&1&&(o(0,"th",11),m(1," Date "),n())}function Lt(t,e){if(t&1&&(o(0,"td",12),m(1),K(2,"date"),n()),t&2){let a=e.$implicit;l(),C(" ",Q(2,1,a.createdAt)," ")}}function Bt(t,e){t&1&&(o(0,"th",11),m(1," From "),n())}function Gt(t,e){if(t&1&&(o(0,"td",12),p(1,"app-member-display",13),n()),t&2){let a=e.$implicit;l(),c("member",a.fromMember)}}function Ot(t,e){t&1&&(o(0,"th",11),m(1," To "),n())}function zt(t,e){if(t&1&&(o(0,"td",12),p(1,"app-member-display",13),n()),t&2){let a=e.$implicit;l(),c("member",a.toMember)}}function $t(t,e){t&1&&(o(0,"th",11),m(1," Amount "),n())}function Yt(t,e){if(t&1&&(o(0,"td",12),m(1),n()),t&2){let a=e.$implicit;l(),C(" ",a.amount," ")}}function Jt(t,e){t&1&&p(0,"tr",14)}function Kt(t,e){t&1&&p(0,"tr",15)}function Qt(t,e){if(t&1&&(o(0,"table",0),h(1,2),d(2,kt,2,0,"th",3)(3,qt,2,1,"td",4),M(),h(4,5),d(5,Ut,2,0,"th",3)(6,Lt,3,3,"td",4),M(),h(7,6),d(8,Bt,2,0,"th",3)(9,Gt,2,1,"td",4),M(),h(10,7),d(11,Ot,2,0,"th",3)(12,zt,2,1,"td",4),M(),h(13,8),d(14,$t,2,0,"th",3)(15,Yt,2,1,"td",4),M(),d(16,Jt,1,0,"tr",9)(17,Kt,1,0,"tr",10),n()),t&2){let a=f(2);c("dataSource",a.transactions),l(16),c("matHeaderRowDef",a.displayedColumns),l(),c("matRowDefColumns",a.displayedColumns)}}function Wt(t,e){t&1&&(o(0,"div",1),m(1,"No transactions found."),n())}function Xt(t,e){if(t&1&&d(0,Qt,18,3,"table",0)(1,Wt,2,0,"div",1),t&2){let a=f();_((a.transactions==null?null:a.transactions.length)>0?0:1)}}var Vt=(()=>{let e=class e{constructor(i){this._transactionService=i,this.displayedColumns=["index","date","from","to","amount"],this.isLoading=T(!0)}ngOnInit(){this._getTransactions()}ngOnChanges(i){i.specificMemberId&&this._getTransactions()}_getTransactions(){let i=this.specificMemberId?{member:this.specificMemberId}:{};this.isLoading.set(!0),this._transactionService.query(i).pipe(D(()=>this.isLoading.set(!1)),G(r=>r.map(s=>V.createFromApiModel(s)))).subscribe(r=>this.transactions=r)}};e.\u0275fac=function(r){return new(r||e)(u(H))},e.\u0275cmp=b({type:e,selectors:[["app-transactions"]],inputs:{specificMemberId:"specificMemberId"},standalone:!0,features:[$,v],decls:1,vars:1,consts:[["mat-table","",3,"dataSource"],[1,"text-center","mt-4"],["matColumnDef","index"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","from"],["matColumnDef","to"],["matColumnDef","amount"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"member"],["mat-header-row",""],["mat-row",""]],template:function(r,s){r&1&&d(0,Xt,2,1),r&2&&_(s.isLoading()?-1:0)},dependencies:[W,dt,et,nt,mt,ot,it,lt,at,rt,st,ct,N]});let t=e;return t})();var Ht=(()=>{let e=class e{constructor(i,r,s){this.data=i,this._transactionService=r,this._dialogRef=s,this.isSubmitting=!1,this.amountControl=new S(null,[g.required,g.min(0)])}submitTrade(){this.isSubmitting=!0,this._transactionService.trade(this.data.member.id,this.amountControl.value).pipe(D(()=>this.isSubmitting=!1)).subscribe(()=>{this._dialogRef.close(!0)})}};e.\u0275fac=function(r){return new(r||e)(u(Dt),u(H),u(St))},e.\u0275cmp=b({type:e,selectors:[["app-trade-dialog"]],standalone:!0,features:[v],decls:17,vars:4,consts:[["mat-dialog-title",""],[1,"d-flex","justify-content-space-around","align-items-center"],[1,"p-4"],[3,"member"],[1,"w-100","mt-2"],["matInput","","type","number","placeholder","Enter possitive amount...",3,"formControl"],["align","end"],["mat-raised-button","","mat-dialog-close","",1,"mr-2"],[3,"action","disabled","isSubmitting"]],template:function(r,s){r&1&&(o(0,"h2",0),m(1,"New transfer"),n(),o(2,"mat-dialog-content")(3,"div",1)(4,"div",2),m(5," You Send to: "),n(),o(6,"div",2),p(7,"app-member-display",3),n()(),o(8,"mat-form-field",4)(9,"mat-label"),m(10,"Amount"),n(),p(11,"input",5),n()(),o(12,"mat-dialog-actions",6)(13,"button",7),m(14,"Close"),n(),o(15,"app-submit-button",8),x("action",function(){return s.submitTrade()}),m(16,"Send "),n()()),r&2&&(l(7),c("member",s.data.member),l(4),c("formControl",s.amountControl),l(4),c("disabled",!s.amountControl.valid)("isSubmitting",s.isSubmitting))},dependencies:[j,yt,It,Ft,Et,tt,y,N,wt,F,I,bt,E,ht,A,P,R,w,ut]});let t=e;return t})();function ne(t,e){if(t&1){let a=U();o(0,"button",5),x("click",function(){k(a);let r=f(2);return q(r.openTradeDialog())}),o(1,"mat-icon"),m(2,"currency_exchange"),n(),m(3," Send "),n()}}function oe(t,e){if(t&1&&(o(0,"p"),m(1),n(),o(2,"p"),m(3),n(),p(4,"img",3),o(5,"p"),m(6),n(),d(7,ne,4,0,"button",4)),t&2){let a=f();l(),J(a.member().name),l(2),C("",a.member().email," "),l(),c("src",a.member().picture,Y),l(2),C("Balance: ",a.member().balance,""),l(),_(a.isMyProfile?-1:7)}}function ae(t,e){if(t&1){let a=U();o(0,"section",1)(1,"h3"),m(2,"Update profile"),n(),o(3,"form",6)(4,"mat-form-field",7)(5,"mat-label"),m(6,"Name"),n(),p(7,"input",8),n(),o(8,"mat-form-field",7)(9,"mat-label"),m(10,"Profile image url"),n(),p(11,"input",9),n(),o(12,"button",10),x("click",function(){k(a);let r=f();return q(r.update())}),o(13,"mat-icon"),m(14,"save"),n(),m(15," Save "),n()()()}if(t&2){let a=f();l(3),c("formGroup",a.mainForm),l(9),c("disabled",!a.mainForm.dirty||!a.mainForm.valid)}}function re(t,e){if(t&1&&p(0,"app-transactions",2),t&2){let a=f();c("specificMemberId",a.member().id)}}var ze=(()=>{let e=class e{constructor(i,r,s,B){this._appDataService=i,this._profileService=r,this._activatedRoute=s,this._dialog=B,this.member=T(void 0),this._memberId=this._activatedRoute.snapshot.params.memberId,this.mainForm=this._constructForm()}ngOnInit(){this._memberId&&this._loadMemberData(),this._appDataService.currentUser$.subscribe(i=>{this._currentUserId=i?.id,this._memberId||this._bindData(i)}),this._activatedRoute.paramMap.subscribe(i=>{this._memberId=+i.get("memberId"),this._memberId&&this._loadMemberData()})}_loadMemberData(){this._profileService.getMember(this._memberId).subscribe(i=>{this._bindData(i)})}_constructForm(){return new _t({name:new S(null,[g.required]),picture:new S(null)})}_bindData(i){this.isMyProfile=this._currentUserId===i.id,this.member.set(i),this.isMyProfile&&this._bindForm()}_bindForm(){this.member()&&this.mainForm.patchValue({name:this.member().name,picture:this.member().picture})}update(){let i=this._preparePayload();this._profileService.updateCurrentUser(i).subscribe(()=>{this._appDataService.initializeUser(),this.mainForm.markAsPristine()})}_preparePayload(){let i={};return this.mainForm.controls.name.dirty&&(i.name=this.mainForm.controls.name.value),this.mainForm.controls.picture.dirty&&(i.picture=this.mainForm.controls.picture.value),i}openTradeDialog(){this._dialog.open(Ht,{data:{member:this.member()}}).afterClosed().subscribe(r=>{r&&(this._appDataService.initializeUser(),this.isMyProfile||this._loadMemberData())})}};e.\u0275fac=function(r){return new(r||e)(u(Nt),u(At),u(X),u(Tt))},e.\u0275cmp=b({type:e,selectors:[["app-member-profile"]],standalone:!0,features:[v],decls:10,vars:3,consts:[[1,"text-align-center"],[1,"p-4","w-50"],[3,"specificMemberId"],["alt","Profile image","width","100","height","100",3,"src"],["mat-flat-button","","color","primary","aria-label","trade",1,"mb-2"],["mat-flat-button","","color","primary","aria-label","trade",1,"mb-2",3,"click"],[3,"formGroup"],[1,"w-100","mt-2"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Enter image url","formControlName","picture"],["mat-flat-button","","color","primary","aria-label","Add row",1,"mt-2",3,"click","disabled"]],template:function(r,s){r&1&&(o(0,"section",0)(1,"h1"),m(2,"Profile"),n(),d(3,oe,8,5),n(),p(4,"mat-divider"),d(5,ae,16,2,"section",1),o(6,"section",1)(7,"h3"),m(8,"Transaction history"),n(),d(9,re,1,1,"app-transactions",2),n()),r&2&&(l(3),_(s.member()?3:-1),l(2),_(s.isMyProfile?5:-1),l(4),_(s.member()?9:-1))},dependencies:[Pt,Rt,F,Ct,I,E,ft,Mt,vt,xt,R,w,A,P,y,pt,Vt,Z,j]});let t=e;return t})();export{ze as MemberProfileComponent};
